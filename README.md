# üó∫Ô∏è Extractor-Mapas

## English

### Introduction

**Extractor-Mapas** is an automated tool designed to extract geospatial information from flat PDF maps using Optical Character Recognition (OCR) and computer vision techniques. This tool was specifically developed to process maps generated and distributed by the Direcci√≥n de Obras Hidr√°ulicas (DOH) for Rural Sanitation Services (Servicios Sanitarios Rurales - SSR) in Chile.

#### Key Features

- üîç **Automated Coordinate Extraction**: Uses OCR technology to detect and extract UTM coordinate tables from PDF documents and images
- üñºÔ∏è **Image Processing**: Converts PDFs to images and applies advanced preprocessing for optimal text recognition
- üìä **Data Structuring**: Automatically parses and structures extracted coordinates into downloadable CSV format
- üéõÔ∏è **Configurable Settings**: Adjustable DPI and contrast threshold for different document qualities
- üåê **Web-Based Interface**: User-friendly Streamlit application accessible through any web browser
- üó∫Ô∏è **Projection Detection**: Identifies hidden projection information (e.g., WGS1984 UTM18S) within PDF files
- üîÑ **Multi-Page Support**: Processes multi-page PDF documents with page selection capability

### Usage Instructions

#### Prerequisites

Before running the application, ensure you have the following installed:

- Python 3.7 or higher
- Tesseract OCR engine
- Poppler utilities (for PDF processing)

#### Installation

1. **Clone the repository**:
   ```bash
   git clone https://github.com/nicofierrov/extractor-mapas.git
   cd extractor-mapas
   ```

2. **Install Python dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Install system packages** (Linux/Ubuntu):
   ```bash
   sudo apt-get update
   sudo apt-get install tesseract-ocr tesseract-ocr-spa libgl1 poppler-utils
   ```

   For other operating systems:
   - **macOS**: `brew install tesseract poppler`
   - **Windows**: Download and install [Tesseract](https://github.com/UB-Mannheim/tesseract/wiki) and [Poppler](http://blog.alivate.com.au/poppler-windows/)

#### Running the Application

1. **Start the Streamlit application**:
   ```bash
   streamlit run app.py
   ```

2. **Access the web interface**:
   - The application will automatically open in your default browser
   - If not, navigate to `http://localhost:8501`

#### How to Use

1. **Upload a file**: 
   - Click "Sube tu archivo" (Upload your file)
   - Select a PDF or image file (PNG, JPG, JPEG) containing a coordinate table
   
2. **Configure settings** (optional):
   - Adjust **DPI** (200-500): Higher values improve accuracy for small text but increase processing time
   - Adjust **Contrast Filter** (0-255): Fine-tune to reduce background noise

3. **Process the document**:
   - If multi-page PDF, select the page containing the coordinate table
   - Review the preprocessed image to ensure the table is visible
   - Click "üîç Extraer Coordenadas con IA" to extract coordinates

4. **Download results**:
   - Review the extracted coordinate table
   - Download as CSV for use in GIS software (QGIS, ArcGIS, etc.)

#### Example Input/Output

**Input**: PDF or image file containing a table like:

```
V√©rtice    Este         Norte
1          675123.45    5234567.89
2          675234.56    5234678.90
3          675345.67    5234789.01
```

**Output**: Structured CSV file:

```csv
V√©rtice,Este,Norte,Texto_Original
1,675123,5234567,"1    675123.45    5234567.89"
2,675234,5234678,"2    675234.56    5234678.90"
3,675345,5234789,"3    675345.67    5234789.01"
```

### Dependencies and Technologies

#### Python Libraries

- **streamlit**: Web application framework for the user interface
- **pdf2image**: Converts PDF documents to images for processing
- **pytesseract**: Python wrapper for Google's Tesseract OCR engine
- **opencv-python-headless**: Computer vision library for image preprocessing
- **pandas**: Data manipulation and CSV export functionality
- **numpy**: Numerical computing for image array operations
- **pillow**: Python Imaging Library for image handling

#### System Dependencies

- **Tesseract OCR** (v4.0+): Open-source OCR engine
- **Tesseract Spanish Language Pack**: For improved Spanish text recognition
- **Poppler Utils**: PDF rendering library
- **OpenGL Libraries** (libgl1): Required for OpenCV operations

#### Related Technologies

- **QGIS**: The source PDFs are typically generated using QGIS (Quantum GIS)
- **WGS1984 UTM18S**: Standard coordinate reference system for Isla Grande de Chilo√© region

### Limitations and Demo Version

#### Demo Version Notice

‚ö†Ô∏è **This is a demonstration version.** The full production version of this tool is not publicly available.

#### Known Limitations

1. **PDF Compatibility**:
   - Designed specifically for PDFs generated by DOH using QGIS
   - May not work correctly with PDFs from other sources or with different layouts
   - Best results with "flat" (non-layered) PDF documents

2. **OCR Accuracy**:
   - Partially digitized PDFs may require manual verification
   - OCR accuracy depends on image quality and document contrast
   - Small text or low-resolution scans may produce errors

3. **Projection Detection**:
   - Hidden projection information (e.g., white text on white background) may not always be detected
   - Manual verification of coordinate reference system is recommended
   - Default assumption is WGS1984 UTM18S for Chilo√© region

4. **Processing Speed**:
   - High DPI settings (>300) may result in slower processing times
   - Large multi-page PDF files require more processing time

5. **Coordinate Format**:
   - Optimized for Chilean UTM coordinate formats (6-7 digit coordinates)
   - May require adjustment for other coordinate systems or formats

#### Recommendations

- Always verify extracted coordinates before using them in production systems
- Test with a small sample of your documents first
- Adjust DPI and contrast settings based on your specific document quality
- For critical applications, consider manual verification of results

### License

This project is currently unlicensed. Please contact the repository owner for usage permissions and licensing information.

---
---

## Espa√±ol

### Introducci√≥n

**Extractor-Mapas** es una herramienta automatizada dise√±ada para extraer informaci√≥n geoespacial de mapas PDF planos utilizando t√©cnicas de Reconocimiento √ìptico de Caracteres (OCR) y visi√≥n artificial. Esta herramienta fue desarrollada espec√≠ficamente para procesar mapas generados y distribuidos por la Direcci√≥n de Obras Hidr√°ulicas (DOH) para Servicios Sanitarios Rurales (SSR) en Chile.

#### Caracter√≠sticas Principales

- üîç **Extracci√≥n Automatizada de Coordenadas**: Utiliza tecnolog√≠a OCR para detectar y extraer tablas de coordenadas UTM de documentos PDF e im√°genes
- üñºÔ∏è **Procesamiento de Im√°genes**: Convierte PDFs a im√°genes y aplica preprocesamiento avanzado para un reconocimiento √≥ptimo de texto
- üìä **Estructuraci√≥n de Datos**: Analiza y estructura autom√°ticamente las coordenadas extra√≠das en formato CSV descargable
- üéõÔ∏è **Configuraci√≥n Ajustable**: DPI y umbral de contraste ajustables para diferentes calidades de documento
- üåê **Interfaz Web**: Aplicaci√≥n Streamlit f√°cil de usar accesible desde cualquier navegador web
- üó∫Ô∏è **Detecci√≥n de Proyecci√≥n**: Identifica informaci√≥n de proyecci√≥n oculta (ej. WGS1984 UTM18S) dentro de archivos PDF
- üîÑ **Soporte Multi-P√°gina**: Procesa documentos PDF de m√∫ltiples p√°ginas con capacidad de selecci√≥n de p√°gina

### Instrucciones de Uso

#### Requisitos Previos

Antes de ejecutar la aplicaci√≥n, aseg√∫rese de tener instalado lo siguiente:

- Python 3.7 o superior
- Motor OCR Tesseract
- Utilidades Poppler (para procesamiento de PDF)

#### Instalaci√≥n

1. **Clonar el repositorio**:
   ```bash
   git clone https://github.com/nicofierrov/extractor-mapas.git
   cd extractor-mapas
   ```

2. **Instalar dependencias de Python**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Instalar paquetes del sistema** (Linux/Ubuntu):
   ```bash
   sudo apt-get update
   sudo apt-get install tesseract-ocr tesseract-ocr-spa libgl1 poppler-utils
   ```

   Para otros sistemas operativos:
   - **macOS**: `brew install tesseract poppler`
   - **Windows**: Descargar e instalar [Tesseract](https://github.com/UB-Mannheim/tesseract/wiki) y [Poppler](http://blog.alivate.com.au/poppler-windows/)

#### Ejecutar la Aplicaci√≥n

1. **Iniciar la aplicaci√≥n Streamlit**:
   ```bash
   streamlit run app.py
   ```

2. **Acceder a la interfaz web**:
   - La aplicaci√≥n se abrir√° autom√°ticamente en su navegador predeterminado
   - Si no, navegue a `http://localhost:8501`

#### C√≥mo Usar

1. **Subir un archivo**: 
   - Haga clic en "Sube tu archivo"
   - Seleccione un archivo PDF o imagen (PNG, JPG, JPEG) que contenga una tabla de coordenadas
   
2. **Configurar ajustes** (opcional):
   - Ajuste el **DPI** (200-500): Valores m√°s altos mejoran la precisi√≥n para texto peque√±o pero aumentan el tiempo de procesamiento
   - Ajuste el **Filtro de Contraste** (0-255): Ajuste fino para reducir el ruido de fondo

3. **Procesar el documento**:
   - Si es un PDF de m√∫ltiples p√°ginas, seleccione la p√°gina que contiene la tabla de coordenadas
   - Revise la imagen preprocesada para asegurar que la tabla sea visible
   - Haga clic en "üîç Extraer Coordenadas con IA" para extraer coordenadas

4. **Descargar resultados**:
   - Revise la tabla de coordenadas extra√≠das
   - Descargue como CSV para usar en software GIS (QGIS, ArcGIS, etc.)

#### Ejemplo de Entrada/Salida

**Entrada**: Archivo PDF o imagen que contenga una tabla como:

```
V√©rtice    Este         Norte
1          675123.45    5234567.89
2          675234.56    5234678.90
3          675345.67    5234789.01
```

**Salida**: Archivo CSV estructurado:

```csv
V√©rtice,Este,Norte,Texto_Original
1,675123,5234567,"1    675123.45    5234567.89"
2,675234,5234678,"2    675234.56    5234678.90"
3,675345,5234789,"3    675345.67    5234789.01"
```

### Dependencias y Tecnolog√≠as

#### Librer√≠as Python

- **streamlit**: Framework de aplicaciones web para la interfaz de usuario
- **pdf2image**: Convierte documentos PDF a im√°genes para procesamiento
- **pytesseract**: Wrapper de Python para el motor OCR Tesseract de Google
- **opencv-python-headless**: Librer√≠a de visi√≥n artificial para preprocesamiento de im√°genes
- **pandas**: Funcionalidad de manipulaci√≥n de datos y exportaci√≥n a CSV
- **numpy**: Computaci√≥n num√©rica para operaciones con arrays de im√°genes
- **pillow**: Python Imaging Library para manejo de im√°genes

#### Dependencias del Sistema

- **Tesseract OCR** (v4.0+): Motor OCR de c√≥digo abierto
- **Paquete de Idioma Espa√±ol Tesseract**: Para mejorar el reconocimiento de texto en espa√±ol
- **Poppler Utils**: Librer√≠a de renderizado de PDF
- **Librer√≠as OpenGL** (libgl1): Requeridas para operaciones de OpenCV

#### Tecnolog√≠as Relacionadas

- **QGIS**: Los PDFs de origen t√≠picamente son generados usando QGIS (Quantum GIS)
- **WGS1984 UTM18S**: Sistema de referencia de coordenadas est√°ndar para la regi√≥n de Isla Grande de Chilo√©

### Limitaciones y Versi√≥n de Demostraci√≥n

#### Aviso de Versi√≥n de Demostraci√≥n

‚ö†Ô∏è **Esta es una versi√≥n de demostraci√≥n.** La versi√≥n de producci√≥n completa de esta herramienta no est√° disponible p√∫blicamente.

#### Limitaciones Conocidas

1. **Compatibilidad de PDF**:
   - Dise√±ado espec√≠ficamente para PDFs generados por DOH usando QGIS
   - Puede no funcionar correctamente con PDFs de otras fuentes o con dise√±os diferentes
   - Mejores resultados con documentos PDF "planos" (sin capas)

2. **Precisi√≥n del OCR**:
   - PDFs parcialmente digitalizados pueden requerir verificaci√≥n manual
   - La precisi√≥n del OCR depende de la calidad de la imagen y el contraste del documento
   - Texto peque√±o o escaneos de baja resoluci√≥n pueden producir errores

3. **Detecci√≥n de Proyecci√≥n**:
   - Informaci√≥n de proyecci√≥n oculta (ej. texto blanco sobre fondo blanco) puede no ser siempre detectada
   - Se recomienda verificaci√≥n manual del sistema de referencia de coordenadas
   - La suposici√≥n predeterminada es WGS1984 UTM18S para la regi√≥n de Chilo√©

4. **Velocidad de Procesamiento**:
   - Configuraciones de DPI altas (>300) pueden resultar en tiempos de procesamiento m√°s lentos
   - Archivos PDF grandes de m√∫ltiples p√°ginas requieren m√°s tiempo de procesamiento

5. **Formato de Coordenadas**:
   - Optimizado para formatos de coordenadas UTM chilenas (coordenadas de 6-7 d√≠gitos)
   - Puede requerir ajustes para otros sistemas o formatos de coordenadas

#### Recomendaciones

- Siempre verifique las coordenadas extra√≠das antes de usarlas en sistemas de producci√≥n
- Pruebe primero con una muestra peque√±a de sus documentos
- Ajuste la configuraci√≥n de DPI y contraste seg√∫n la calidad espec√≠fica de su documento
- Para aplicaciones cr√≠ticas, considere la verificaci√≥n manual de los resultados

### Licencia

Este proyecto actualmente no tiene licencia. Por favor, contacte al propietario del repositorio para obtener permisos de uso e informaci√≥n sobre licencias.